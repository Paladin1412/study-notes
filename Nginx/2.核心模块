### 查询nginx执行状态

```status.conf
server {
    location = /status {
        stub_status on;
    }
}
nginx -s reload

http://127.0.0.1/status
```

history 查询历史命令
!序号

### 随机主页
- with-http_random_index_module 在根目录里随机选择一个主页显示
```
# Syntax: random_index on/off;
# Default: off
# Context: location

/etc/nginx/conf.d/default.conf

location / {
    root /opt/app;
    random_index on;
}

```

### 内容替换，输出文本替换
```/etc/nginx/conf.d/default.conf
location / {
    root /usr/share/nginx/html;
    index index.html index.htm;
    sub_filter '原字符串' '新字符串';
    sub_filter_once off; # 全部替换
}

```
### 请求限制
- 限制连接数
- 限制请求数
--with-limit_conn_module 链接频率限制
--with-limit_req_module 请求频率限制
一次TCP请求至少产生一个HTTP请求
- 三次握手
SYN > SYC,ACK -> ACK
- 四次挥手
FIN -> ACK -> FIN -> ACK
- 全流程
SYN > SYC,ACK -> ACK -> REQUEST -> RESPONSE -> FIN -> ACK -> FIN -> ACK
为什么握手三次，挥手四次？
因为客户端需要断开，服务端接收到断开消息，但此时信息可能没有发完，所以在可以断开的时候需要通知客户端，可以断开。所以会多一次挥手。
断开？断开！断开？断开！

- ab
Apache 的命令模拟多线程并发请求，测试服务器负载压力，也可以测试nginx,linghthttp,iis等其他web服务器的压力
-n 总共的请求数
-c 并发的请求数
```
ab -b 40 -c 20 http://127.0.0.1/
```

### 请求限制
limit_req_zone
限制每秒的请求数
limit_req_zone key zone=name:size rate=rate;
limit_req;

```
limit_req_zone $binary_remote_addr zone=req_zone:1m rate=1r/s;
server {
    location / {
        limit_req req_zone;
        limit_req zone=req_zone burst=3 nodelay;
    }
}
```

### 静态资源web服务器
静态资源: 一般客户端发送请求到web服务器，web服务器从内存中取到相应的文件，返回给客户端，客户端解析并渲染显示出来。
鼎泰资源: 一般客户端请求的动态资源，先将请求交于web容器，web容器链接数据库，数据库处理数据之后，将内容教给web服务器，web服务器返回给客户端解析渲染处理

```
    location ~ ^/api { // 如果访问/api开头的路径，转到发http://localhost:3000
        proxy_pass http://localhost:3000
    }
```

浏览器资源: html, css, js
图片: jpeg, gif, png
视频: flv, mpeg
下载文件: word, excel

CDN:
CDN 的全称是 Content Delivery Network 即内容分发网络
CDN 系统能够事实地根据网络流量和各节点的链接，负载状况以及到用户的距离和相应的时间等综合信息将用户的请求重新导向距离用户最近的服务器节点上，其目的是使用户可就近取得所需要的内容，解决Internet网络拥挤的状况，提高用户访问网站的响应速度


### 跨域
```
location ~ ^/api {
    add_header Access-Control-Allow-Origin http://192.168.20.1:8080;
    add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS;
    proxy_pass http://127.0.0.1:3000;
}
```

### 防盗链
防止网站资源被盗用
保证信息安全
防止流量过量

需要区别哪些请求是非正常的用户请求
使用http_refer防盗链
```
valid_referers none blocked 47.104.184.134;
if ($invalid_referer) { // 验证通过为0，不用过为1
    return 403;
}

```
### 代理服务
proxy_pass URL
- 正向代理
正向代理的对象是客户端，服务端看不到真正的客户端
通过公司代理服务器上网
- 反向代理