### 查询nginx执行状态

```status.conf
server {
    location = /status {
        stub_status on;
    }
}
nginx -s reload

http://127.0.0.1/status
```

history 查询历史命令
!序号

### 随机主页
- with-http_random_index_module 在根目录里随机选择一个主页显示
```
# Syntax: random_index on/off;
# Default: off
# Context: location

/etc/nginx/conf.d/default.conf

location / {
    root /opt/app;
    random_index on;
}

```

### 内容替换，输出文本替换
```/etc/nginx/conf.d/default.conf
location / {
    root /usr/share/nginx/html;
    index index.html index.htm;
    sub_filter '原字符串' '新字符串';
    sub_filter_once off; # 全部替换
}

```
### 请求限制
- 限制连接数
- 限制请求数
--with-limit_conn_module 链接频率限制
--with-limit_req_module 请求频率限制
一次TCP请求至少产生一个HTTP请求
- 三次握手
SYN > SYC,ACK -> ACK
- 四次挥手
FIN -> ACK -> FIN -> ACK
- 全流程
SYN > SYC,ACK -> ACK -> REQUEST -> RESPONSE -> FIN -> ACK -> FIN -> ACK
为什么握手三次，挥手四次？
因为客户端需要断开，服务端接收到断开消息，但此时信息可能没有发完，所以在可以断开的时候需要通知客户端，可以断开。所以会多一次挥手。
断开？断开！断开？断开！

- ab
Apache 的命令模拟多线程并发请求，测试服务器负载压力，也可以测试nginx,linghthttp,iis等其他web服务器的压力
-n 总共的请求数
-c 并发的请求数
```
ab -b 40 -c 20 http://127.0.0.1/
```

### 请求限制
limit_req_zone
限制每秒的请求数
limit_req_zone key zone=name:size rate=rate;
limit_req;

```
limit_req_zone $binary_remote_addr zone=req_zone:1m rate=1r/s;
server {
    location / {
        limit_req req_zone;
        limit_req zone=req_zone burst=3 nodelay;
    }
}
```
